(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{620:function(t,s,a){"use strict";a.r(s);var r=a(24),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[t._v("#")]),t._v(" 使用场景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("高性能")]),t._v(" "),a("p",[t._v("提高后续请求的响应时间")])]),t._v(" "),a("li",[a("p",[t._v("高并发")]),t._v(" "),a("p",[t._v("分流请求，将大部分请求路由至缓存处理")])])]),t._v(" "),a("h2",{attrs:{id:"数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[t._v("#")]),t._v(" 数据类型")]),t._v(" "),a("h3",{attrs:{id:"string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#string"}},[t._v("#")]),t._v(" String")]),t._v(" "),a("h5",{attrs:{id:"数据要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据要求"}},[t._v("#")]),t._v(" 数据要求")]),t._v(" "),a("p",[t._v("键值可以为任何数据（最大为512M）【如jpeg图像或序列化的对象】")]),t._v(" "),a("h5",{attrs:{id:"常用操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作"}},[t._v("#")]),t._v(" 常用操作")]),t._v(" "),a("h6",{attrs:{id:"增删改查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增删改查"}},[t._v("#")]),t._v(" 增删改查")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nOK\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" get "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" del "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("\n")])])]),a("h6",{attrs:{id:"字符串操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串操作"}},[t._v("#")]),t._v(" 字符串操作")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" strlen "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" append "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" getrange "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pos"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pos"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 双闭区间截取（java中对应方法为开闭截取）")]),t._v("\n")])])]),a("h6",{attrs:{id:"特殊操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特殊操作"}},[t._v("#")]),t._v(" 特殊操作")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("数值自增")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" incr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" incrby "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("increment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" incrbyfloat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("increment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("若数据不能转换为数值，或运算结果超出"),a("code",[t._v("Long.MAX_VALUE")]),t._v("，则报错")])])]),t._v(" "),a("li",[a("p",[t._v("设置数据生命周期")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" setex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" psetex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("blockquote",[a("p",[a("code",[t._v("java.String.substring()")]),t._v("方法为左闭右开区间截取")])]),t._v(" "),a("h5",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),a("p",[t._v("多用于数据整体存取")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储结构型或非结构型热点数据")]),t._v(" "),a("blockquote",[a("p",[t._v("数据key命名规范：")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[t._v("set <表名>:<主键名>:<主键值> <多字段JSON对象>")])]),t._v(" "),a("li",[a("code",[t._v("set <表名>:<主键名>:<主键值>:<字段名> <字段值>")]),t._v("（性能较优）")])])])]),t._v(" "),a("li",[a("p",[t._v("用作RDBMS分表主键生成策略（分批生成，无需考虑并发问题）")])])]),t._v(" "),a("h3",{attrs:{id:"hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[t._v("#")]),t._v(" Hash")]),t._v(" "),a("h5",{attrs:{id:"数据要求-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据要求-2"}},[t._v("#")]),t._v(" 数据要求")]),t._v(" "),a("p",[t._v("底层为哈希表（"),a("code",[t._v("field")]),t._v("-"),a("code",[t._v("value")]),t._v("），哈希值只能为字符串")]),t._v(" "),a("h5",{attrs:{id:"常用操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作-2"}},[t._v("#")]),t._v(" 常用操作")]),t._v(" "),a("h6",{attrs:{id:"增删改查-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增删改查-2"}},[t._v("#")]),t._v(" 增删改查")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1表示field数目变化，0表示不变（不论失败与否）")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hdel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("field2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hgetall "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hmset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hmget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("h6",{attrs:{id:"集合操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作"}},[t._v("#")]),t._v(" 集合操作")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hlen "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" x\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hexists "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hkeys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hvals "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hsetnx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1表示成功，0表示失败")]),t._v("\n")])])]),a("h6",{attrs:{id:"特殊操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特殊操作-2"}},[t._v("#")]),t._v(" 特殊操作")]),t._v(" "),a("ul",[a("li",[t._v("数值自增")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hincrby "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("increment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" hincrbyfloat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("increment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h5",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),a("ul",[a("li",[t._v("相比于String操作，内存与CPU消耗更低")]),t._v(" "),a("li",[t._v("Hash中每个key最多可以存储2^32-1个键值对，不可将Hash作为对象列表滥用")]),t._v(" "),a("li",[t._v("当Hash中key未达到阈值或单个元素较小时，底层为Ziplist，按插入顺序进行紧密存储；若Hash中key过多，底层转换为哈希，数据改为无序排列，遍历所有field的效率很低，此时应将key进行分片存储")])]),t._v(" "),a("h5",{attrs:{id:"应用场景-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-2"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),a("p",[t._v("多用于同类数据的归类整合与数据的局部更新")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储购物车数据")]),t._v(" "),a("p",[t._v("以用户id为key，针对每位用户创建Hash，并以商品id作为field，商品加车数量作为value进行存储")]),t._v(" "),a("blockquote",[a("p",[t._v("同时额外维护商品信息Hash进行解耦，使用"),a("code",[t._v("setnx")]),t._v("更新商品信息")])])]),t._v(" "),a("li",[a("p",[t._v("存储抢购、限购时的商品数量")]),t._v(" "),a("p",[t._v("以商家id为key，商品id作为field，商品剩余数量作为value进行存储")]),t._v(" "),a("blockquote",[a("p",[t._v("超卖问题")])])])]),t._v(" "),a("h3",{attrs:{id:"list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#list"}},[t._v("#")]),t._v(" List")]),t._v(" "),a("h5",{attrs:{id:"数据要求-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据要求-3"}},[t._v("#")]),t._v(" 数据要求")]),t._v(" "),a("p",[t._v("底层为双向链表，元素必须为"),a("strong",[t._v("字符串")]),t._v("；可实现双端队列操作")]),t._v(" "),a("h5",{attrs:{id:"常用操作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作-3"}},[t._v("#")]),t._v(" 常用操作")]),t._v(" "),a("h6",{attrs:{id:"增删改查-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增删改查-3"}},[t._v("#")]),t._v(" 增删改查")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" lpush "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" x\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rpush "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" x\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" lrange "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("end"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# end为-1时遍历全部元素")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" lindex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" lpop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rpop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" lrem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" x\n")])])]),a("h6",{attrs:{id:"集合操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作-2"}},[t._v("#")]),t._v(" 集合操作")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" llen "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" x\n")])])]),a("h6",{attrs:{id:"特殊操作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特殊操作-3"}},[t._v("#")]),t._v(" 特殊操作")]),t._v(" "),a("ul",[a("li",[t._v("阻塞式出列")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" blpop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" brpop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("阻塞轮询场景下的异常处理")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("brpoplpush")]),t._v("将目标list中数据出队，并加入备份list")]),t._v(" "),a("li",[t._v("发生异常时，"),a("code",[t._v("blpoprpush")]),t._v("将备份list中数据还原回目标list；不发生异常时，"),a("code",[t._v("blpop")]),t._v("移除备份list中数据")])])]),t._v(" "),a("h5",{attrs:{id:"注意事项-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项-2"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),a("ul",[a("li",[t._v("作为链表，数据读取速度较慢")]),t._v(" "),a("li",[t._v("每个key最多可以存储2^32-1个元素")])]),t._v(" "),a("h5",{attrs:{id:"应用场景-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-3"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储朋友圈点赞顺序、社交网站关注列表信息等")]),t._v(" "),a("blockquote",[a("p",[t._v("使用"),a("code",[t._v("rpush")]),t._v("添加点赞，"),a("code",[t._v("lrem")]),t._v("移除点赞，"),a("code",[t._v("lrange")]),t._v("遍历点赞名单，"),a("code",[t._v("lindex")]),t._v("获取点赞状态（用户是否已点赞）")])])]),t._v(" "),a("li",[a("p",[t._v("存储信息聚合类网站待推送博文等"),a("strong",[t._v("热点信息")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("普通博文")])]),t._v(" "),a("p",[t._v("（对于每一关注者）使用"),a("code",[t._v("rpush")]),t._v("添加待推送博文，"),a("code",[t._v("lrange")]),t._v("遍历待推送博文")]),t._v(" "),a("p",[a("strong",[t._v("大V博文")])])])]),t._v(" "),a("li",[a("p",[t._v("存储多台服务器先后输出的日志等严格区分操作顺序的数据信息（"),a("strong",[t._v("可持久化")]),t._v("）")])])]),t._v(" "),a("h3",{attrs:{id:"set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set"}},[t._v("#")]),t._v(" Set")]),t._v(" "),a("h5",{attrs:{id:"数据要求-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据要求-4"}},[t._v("#")]),t._v(" 数据要求")]),t._v(" "),a("p",[t._v("底层为value值为空的Hash（"),a("code",[t._v("Map<String, null>")]),t._v("）；查找元素复杂度为O(1)")]),t._v(" "),a("h5",{attrs:{id:"常用操作-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作-4"}},[t._v("#")]),t._v(" 常用操作")]),t._v(" "),a("h6",{attrs:{id:"增删改查-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增删改查-4"}},[t._v("#")]),t._v(" 增删改查")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sadd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1表示元素数目变化，0表示不变（不论失败与否）")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" smembers "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" srem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])])]),a("h6",{attrs:{id:"集合操作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作-3"}},[t._v("#")]),t._v(" 集合操作")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" scard "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" x\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sismember "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),a("p",[t._v("特殊操作")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("移动元素")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" smove "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("随机获取元素")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" srandmember "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" spop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])])])]),t._v(" "),a("li",[a("p",[t._v("交并差集")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sinter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sunion "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sdiff")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 具有方向性")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sinterstore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sunionstore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sdiffstore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])])])]),t._v(" "),a("h5",{attrs:{id:"注意事项-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项-3"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),a("ul",[a("li",[t._v("无法插入重复元素")])]),t._v(" "),a("h5",{attrs:{id:"应用场景-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-4"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储资讯或新媒体类网站用户兴趣等随机推荐信息")]),t._v(" "),a("blockquote",[a("p",[t._v("系统将热门分类信息存入Set，随机挑选出部分分类结合用户已关注信息合并推送给用户")])])]),t._v(" "),a("li",[a("p",[t._v("存储同类信息的关联搜索与深度关联搜索等")]),t._v(" "),a("blockquote",[a("p",[t._v("共同关注："),a("code",[t._v("sinter")])]),t._v(" "),a("p",[t._v("我关注的人也关注TA："),a("code",[t._v("sismember")]),t._v("（大V场景优化）")]),t._v(" "),a("p",[t._v("可能关注："),a("code",[t._v("sdiff")])])])]),t._v(" "),a("li",[a("p",[t._v("用于同类型全局数据的快速去重（如网站UV/IP访问量）与快速定位（如网站黑白名单）")])]),t._v(" "),a("li",[a("p",[t._v("存储抽奖用户信息")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("sadd")]),t._v("添加抽奖用户，"),a("code",[t._v("srandmember")]),t._v("/"),a("code",[t._v("spop")]),t._v("进行抽奖")])])])]),t._v(" "),a("h3",{attrs:{id:"zset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zset"}},[t._v("#")]),t._v(" ZSet")]),t._v(" "),a("h5",{attrs:{id:"数据要求-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据要求-5"}},[t._v("#")]),t._v(" 数据要求")]),t._v(" "),a("p",[t._v("底层为额外添加score字段的Set；查找元素复杂度为O(1)")]),t._v(" "),a("h5",{attrs:{id:"常用操作-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用操作-5"}},[t._v("#")]),t._v(" 常用操作")]),t._v(" "),a("h6",{attrs:{id:"增删改查-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增删改查-5"}},[t._v("#")]),t._v(" 增删改查")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zadd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("score"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("score"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# score值在前，value值在后")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrange "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("end"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 按照score值从小到大进行排序")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrevrange "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("end"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zpopmin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zpopmax "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h6",{attrs:{id:"集合操作-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作-4"}},[t._v("#")]),t._v(" 集合操作")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zcard "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zcount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sinterstore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("numkeys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AGGREGATE SUM"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("MIN"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("MAX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# AGGREGATE参数表示交并差集操作后对符合条件元素score值的操作")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sunionstore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("numkeys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AGGREGATE SUM"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("MIN"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("MAX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sdiffstore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("numkeys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AGGREGATE SUM"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("MIN"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("MAX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h6",{attrs:{id:"特殊操作-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特殊操作-4"}},[t._v("#")]),t._v(" 特殊操作")]),t._v(" "),a("ul",[a("li",[t._v("根据score操作")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrank "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrevrank "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zscore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zincrby "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("increment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrangebyscore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("LIMIT "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("offset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zrevrangebyscore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("LIMIT "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("offset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zremrangebyrank "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("end"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" zremrangebyscore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h5",{attrs:{id:"注意事项-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项-4"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),a("ul",[a("li",[t._v("能够插入相同元素，并导致该元素score值更新（返回"),a("code",[t._v("(Integer) 0")]),t._v("说明元素数目不变）")]),t._v(" "),a("li",[t._v("score值作为整数，上限为2^64-1；作为浮点数，可能会有精度丢失")])]),t._v(" "),a("h5",{attrs:{id:"应用场景-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-5"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储排行榜（如热门直播、好友亲密度、热销商品、微博热搜等）数据并进行组合统计（"),a("strong",[t._v("可持久化")]),t._v("）")])]),t._v(" "),a("li",[a("p",[t._v("存储基础+增值类服务（如云盘、游戏或观影VIP等）的用户会员（体验会员）信息，或限时服务（如投票、私密讨论、限期优惠券等）信息）")]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("限时服务：将过期时间作为score，利用排序功能区分业务处理（如中止服务）的先后顺序，同时过期服务进行移除，并按照不同时间段逐级提升（如将一小时内即将逾期的服务加入ZSet进行处理，全部处理完后再加入下一小时即将逾期的服务）（"),a("strong",[t._v("可持久化")]),t._v("）")]),t._v(" "),a("li",[t._v("限次服务（无需按服务排序）：使用String，通过"),a("code",[t._v("setex uid:appid 60 1")]),t._v("初始化使用次数（如60s内使用x次），若"),a("code",[t._v("get")]),t._v("次数达到x次上限，则停止提供服务，特定时间段过后key过期，重新初始化计数（"),a("strong",[t._v("无需持久化")]),t._v("）")])])])]),t._v(" "),a("li",[a("p",[t._v("基本延时消息队列（将消息发布时间戳作为score）")])])]),t._v(" "),a("h4",{attrs:{id:"其他应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他应用场景"}},[t._v("#")]),t._v(" 其他应用场景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储社交类应用所接收的用户消息等基于时间顺序的数据信息（"),a("strong",[t._v("可持久化")]),t._v("）")]),t._v(" "),a("blockquote",[a("p",[t._v("先判断该消息是否在"),a("strong",[t._v("置顶Set")]),t._v("中，选择"),a("strong",[t._v("置顶List")]),t._v("或"),a("strong",[t._v("普通List")]),t._v("，先移除List中的相同key，再重新插入；也可使用ZSet，score值维护消息最后发送的时刻")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("同时使用String或Hash计数器另行维护消息数目，与List进行同步更新")])]),t._v(" "),a("h3",{attrs:{id:"bitmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bitmap"}},[t._v("#")]),t._v(" Bitmap")]),t._v(" "),a("p",[a("strong",[t._v("应用场景")])]),t._v(" "),a("ul",[a("li",[t._v("统计日活用户等"),a("strong",[t._v("海量数据")])])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("setbit 2020:1021 1 1")]),t._v("记录id（id可进行偏移）为1的用户登录；"),a("code",[t._v("bitcount 2020:1021 0 -1")]),t._v("统计日活用户量（O(n)）")])]),t._v(" "),a("h2",{attrs:{id:"通用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用命令"}},[t._v("#")]),t._v(" 通用命令")]),t._v(" "),a("h5",{attrs:{id:"基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本操作"}},[t._v("#")]),t._v(" 基本操作")]),t._v(" "),a("h6",{attrs:{id:"key相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#key相关"}},[t._v("#")]),t._v(" key相关")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exists "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" del "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rename")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("newKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" renamenx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("newKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h6",{attrs:{id:"数据库相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库相关"}},[t._v("#")]),t._v(" 数据库相关")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dbIndex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" move "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dbIndex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 剪切操作")]),t._v("\n")])])]),a("h5",{attrs:{id:"扩展操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展操作"}},[t._v("#")]),t._v(" 扩展操作")]),t._v(" "),a("h6",{attrs:{id:"key时效性控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#key时效性控制"}},[t._v("#")]),t._v(" Key时效性控制")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" expire "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("seconds"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pexpire "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("milliseconds"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" expireat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("timestamp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pexpireat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ptimestamp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ttl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -2表示已过期，-1表示永不过期")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pttl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" persist "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),a("h2",{attrs:{id:"持久化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持久化"}},[t._v("#")]),t._v(" 持久化")]),t._v(" "),a("p",[a("code",[t._v("bgsave")]),t._v("原理")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("fork")])]),t._v(" "),a("li",[a("code",[t._v("cow")])])]),t._v(" "),a("h2",{attrs:{id:"事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[t._v("#")]),t._v(" 事务")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" MULTI\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" EXEC/DISCARD\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" WATCH\n")])])]),a("h4",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),a("h3",{attrs:{id:"读操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读操作"}},[t._v("#")]),t._v(" 读操作")]),t._v(" "),a("ul",[a("li",[a("h4",{attrs:{id:"缓存穿透"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存穿透"}},[t._v("#")]),t._v(" 缓存穿透")]),t._v(" "),a("p",[t._v("策略：缓存空值")])]),t._v(" "),a("li",[a("h4",{attrs:{id:"缓存雪崩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存雪崩"}},[t._v("#")]),t._v(" 缓存雪崩")]),t._v(" "),a("p",[t._v("策略：为缓存key过期时间添加额外的随机增量")])]),t._v(" "),a("li",[a("h4",{attrs:{id:"缓存击穿"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存击穿"}},[t._v("#")]),t._v(" 缓存击穿")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("本地锁")]),t._v("（❌）")]),t._v(" "),a("p",[t._v("根据缓存命中结果决定是否进入同步代码块，且在同步代码块头部再次判断缓存是否命中（"),a("strong",[t._v("双重检查")]),t._v("）；在退出同步代码块前写入缓存，保证在下一线程进入同步代码块时缓存已同步")])]),t._v(" "),a("li",[a("h4",{attrs:{id:"分布式锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式锁"}},[t._v("#")]),t._v(" 分布式锁")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SET LOCK_KEY "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" PX "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MILLISECONDS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" NX\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果成功获取锁")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行业务操作")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" DEL LOCK_KEY "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 释放锁")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("过期时间一般为：业务最大耗时✖️120%+平均网络耗时✖️110%（有隐患）")])]),t._v(" "),a("p",[a("strong",[t._v("改进")]),t._v("：")]),t._v(" "),a("p",[t._v("释放锁之前判断锁是否过期，同时是否是自己所设置的锁（如LOCK_KEY值为UUID），通过lua脚本保证该流程为原子操作")]),t._v(" "),a("div",{staticClass:"language-lua extra-class"},[a("pre",{pre:!0,attrs:{class:"language-lua"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" KEYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ARGV"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'del'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" KEYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])])])])])]),t._v(" "),a("h3",{attrs:{id:"写操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写操作"}},[t._v("#")]),t._v(" 写操作")]),t._v(" "),a("ul",[a("li",[a("h4",{attrs:{id:"分布式锁-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式锁-2"}},[t._v("#")]),t._v(" 分布式锁")])])]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("互斥/排他性：在任意时刻，只有一个客户端能持有锁（"),a("code",[t._v("setnx")]),t._v("）")]),t._v(" "),a("li",[t._v("不会发生死锁：即使有客户端在持锁期间由于崩溃而没有主动解锁，也能保证后续客户端加锁成功（主动释放；过期自动释放）")]),t._v(" "),a("li",[t._v("容错性：只要大部分的Redis节点正常运行，客户端就能正常加锁和解锁")]),t._v(" "),a("li",[t._v("解铃还须系铃人：加锁和解锁过程必须由同一个客户端执行，客户端A不能对客户端B所加的锁进行解锁（将value赋值为"),a("code",[t._v("requestId")]),t._v("，代表加锁客户端的唯一请求标识）")])])]),t._v(" "),a("h5",{attrs:{id:"redisson"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redisson"}},[t._v("#")]),t._v(" Redisson")]),t._v(" "),a("p",[t._v("底层通过"),a("strong",[t._v("lua脚本")]),t._v("实现所有操作的原子性")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("RLock")]),t._v("（可重入锁）")]),t._v(" "),a("p",[a("code",[t._v("RLock.lock(超时时间)")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("锁的自动续期")]),t._v(" "),a("p",[t._v("若不指定锁对象的超时时间，则使用默认超时时间"),a("code",[t._v("lockWatchdogTimeout")]),t._v("为30s；一旦占锁成功，启动定时任务每10s（"),a("code",[t._v("internalLockLeaseTime")]),t._v("）执行一次续期脚本")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("RReadWriteLock")]),t._v("（互斥锁/排他锁与共享锁）")]),t._v(" "),a("p",[t._v("保证读操作能获取最新数据")]),t._v(" "),a("ul",[a("li",[t._v("并发读：同时获取读锁")]),t._v(" "),a("li",[t._v("并发写/并发读写（读-写或写-读）：阻塞等待前一线程操作（占有读锁或写锁）成功")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("RSemaphore")])]),t._v(" "),a("p",[t._v("限量操作（通过对锁对象值的增减进行控制）")]),t._v(" "),a("blockquote",[a("p",[t._v("实现分布式限流")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RSemaphore s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// s.release();")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"busy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("RCountDownLatch")])])])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("主从/集群架构故障转移时的锁失效问题")])]),t._v(" "),a("ul",[a("li",[t._v("Redlock多写")])])])]),t._v(" "),a("li",[a("h4",{attrs:{id:"缓存一致性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存一致性"}},[t._v("#")]),t._v(" 缓存一致性")]),t._v(" "),a("blockquote",[a("p",[t._v("通用策略：根据数据时效性合理设置缓存过期时间，使所有的读操作最终以数据库为准（最终一致性）")])]),t._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"双写-弃用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#双写-弃用"}},[t._v("#")]),t._v(" 双写（弃用）")]),t._v(" "),a("p",[t._v("数据更新时先写数据库再覆盖缓存（数据查询时，操作步骤均为先读数据库再写入缓存）")]),t._v(" "),a("blockquote",[a("p",[t._v("由于双写操作非原子操作，可能导致先更新DB的线程后更新缓存，从而造成缓存不一致")]),t._v(" "),a("p",[a("strong",[t._v("注意事项：")])]),t._v(" "),a("ul",[a("li",[t._v("双写过程加锁")])])])]),t._v(" "),a("li",[a("h5",{attrs:{id:"cache-aside-后删"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-aside-后删"}},[t._v("#")]),t._v(" Cache Aside（后删）")]),t._v(" "),a("p",[t._v("数据更新时先写数据库再删缓存")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("注意事项：")])]),t._v(" "),a("ul",[a("li",[t._v("后删过程加锁")]),t._v(" "),a("li",[t._v("若写场景较多，且写入缓存值需经过计算获取，则可使用Cache Aside模式")]),t._v(" "),a("li",[a("strong",[t._v("若第二次未能成功删除缓存导致缓存不一致：")]),t._v(" "),a("ul",[a("li",[t._v("将删除失败的"),a("strong",[t._v("缓存key")]),t._v("或**MySQL binlog日志数据（借助Canal）**存至MQ以进行延时重试")])])])])])]),t._v(" "),a("li",[a("h5",{attrs:{id:"延迟双删"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#延迟双删"}},[t._v("#")]),t._v(" 延迟双删")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tredis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tredis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("数据更新时先淘汰缓存后写数据库再延迟（～1s）删缓存")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("注意事项：")])]),t._v(" "),a("ul",[a("li",[t._v("第一次删除缓存目的：❓")]),t._v(" "),a("li",[t._v("第二次延时删除缓存的目的：确保该时刻其他线程的写缓存操作已经结束，删除缓存后不会再有其他线程写入脏数据")]),t._v(" "),a("li",[t._v("主备分离场景下，延时时间需由主备同步延时时间决定")]),t._v(" "),a("li",[t._v("第二次删除缓存时开辟新线程进行异步操作，提高工作线程（写线程）吞吐量")]),t._v(" "),a("li",[t._v("同样存在Cache Aside模式中淘汰缓存失败所造成的缓存不一致问题")])])])]),t._v(" "),a("li",[a("h6",{attrs:{id:"操作串行化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作串行化"}},[t._v("#")]),t._v(" 操作串行化")]),t._v(" "),a("ul",[a("li",[t._v("写操作：先删缓存，再将更新数据库的操作放入有序队列")]),t._v(" "),a("li",[t._v("读操作：若缓存未命中，读操作也放入有序队列")])]),t._v(" "),a("blockquote",[a("p",[t._v("若读请求大量积压：")]),t._v(" "),a("ul",[a("li",[t._v("将任务队列水平拆分，提高并行度\n"),a("ul",[a("li",[t._v("使用适当的Hash一致性算法保证相同请求路由至相同队列中")])])]),t._v(" "),a("li",[t._v("合理配置限流与降级策略")])])])])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("缓存一致性场景分类")]),t._v("：")]),t._v(" "),a("ol",[a("li",[t._v("低并发操作\n"),a("ol",[a("li",[t._v("基础数据（菜单分类等）：时效容忍度高，可设置较长的缓存过期时间等待数据稳定；也可借助Canal订阅MySQL binlog方式实现缓存数据同步")]),t._v(" "),a("li",[t._v("用户纬度数据（订单数据、用户信息数据等）：并发低，可设置合理的缓存过期时间等待数据稳定")])])]),t._v(" "),a("li",[t._v("高并发操作")])])])])]),t._v(" "),a("h2",{attrs:{id:"删除策略与淘汰算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除策略与淘汰算法"}},[t._v("#")]),t._v(" 删除策略与淘汰算法")]),t._v(" "),a("h4",{attrs:{id:"删除策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除策略"}},[t._v("#")]),t._v(" 删除策略")]),t._v(" "),a("ul",[a("li",[t._v("定时删除策略")]),t._v(" "),a("li",[t._v("惰性删除策略：获取数据时若发现该数据已过期则进行删除")]),t._v(" "),a("li",[t._v("定期删除策略：周期性（每隔100ms）随机抽查存储空间（"),a("strong",[t._v("随机、重点抽查")]),t._v("）")])]),t._v(" "),a("p",[t._v("可能导致缓存雪崩，需灵活配置不同数据的过期时间")]),t._v(" "),a("h4",{attrs:{id:"淘汰-逐出算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#淘汰-逐出算法"}},[t._v("#")]),t._v(" 淘汰/逐出算法")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大可使用内存（60%～70%）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" maxmemory\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每次随机获取待删除数据的个数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" maxmemory-samples\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 待删除数据的逐出算法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" maxmemory-policy\n")])])]),a("h5",{attrs:{id:"maxmemory-policy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maxmemory-policy"}},[t._v("#")]),t._v(" "),a("code",[t._v("maxmemory-policy")])]),t._v(" "),a("ul",[a("li",[t._v("检测易失数据\n"),a("ul",[a("li",[a("code",[t._v("volatile-lru")])]),t._v(" "),a("li",[a("code",[t._v("volatile-lfu")])]),t._v(" "),a("li",[a("code",[t._v("volatile-ttl")])]),t._v(" "),a("li",[a("code",[t._v("volatile-random")])])])]),t._v(" "),a("li",[t._v("检测全表数据\n"),a("ul",[a("li",[a("code",[t._v("allkeys-lru")])]),t._v(" "),a("li",[a("code",[t._v("allkeys-lfu")])]),t._v(" "),a("li",[a("code",[t._v("allkeys-random")])])])]),t._v(" "),a("li",[t._v("禁用\n"),a("ul",[a("li",[a("code",[t._v("no-eviction")])])])])]),t._v(" "),a("blockquote",[a("p",[t._v("通过"),a("code",[t._v("INFO")]),t._v("信息中的"),a("code",[t._v("keyspace-hits")]),t._v("和"),a("code",[t._v("keyspace-misses")]),t._v("属性值判断当前Redis服务的性能，以选择合适的调优策略")])]),t._v(" "),a("h2",{attrs:{id:"高可用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高可用"}},[t._v("#")]),t._v(" 高可用")]),t._v(" "),a("h3",{attrs:{id:"主从"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主从"}},[t._v("#")]),t._v(" 主从")]),t._v(" "),a("h6",{attrs:{id:"工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[t._v("#")]),t._v(" 工作流程")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("建立连接")])]),t._v(" "),a("ol",[a("li",[t._v("slave保存master的ip与端口信息（"),a("code",[t._v("slaveof <ip> <port>")]),t._v("）")]),t._v(" "),a("li",[t._v("slave根据master信息创建连接master的socket，定时发送"),a("code",[t._v("ping")]),t._v("指令")]),t._v(" "),a("li",[t._v("master保存slave的端口信息（"),a("code",[t._v("replconf listening-port <port>")]),t._v("）")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("数据同步")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("slave向master发送"),a("code",[t._v("psync2 ? -1")]),t._v("请求数据同步")])]),t._v(" "),a("li",[a("p",[t._v("master执行"),a("code",[t._v("bgsave")]),t._v("尝试建立快照，同时建立存储增量数据的"),a("strong",[t._v("复制积压缓冲区")])]),t._v(" "),a("p",[t._v("master发送"),a("code",[t._v("+FULLRESYNC <runid> <offset>")]),t._v("，并将RDB文件通过socket发送给slave")])]),t._v(" "),a("li",[a("p",[t._v("slave接收RDB文件和runid以及offset信息，清空本地数据并基于RDB执行数据恢复")]),t._v(" "),a("p",[t._v("slave通过"),a("code",[t._v("psync2 <runid> <offset>")]),t._v("告知master数据同步完成（"),a("strong",[t._v("全量复制")]),t._v("）")])]),t._v(" "),a("li",[a("p",[t._v("（若runid与offset核验通过）master将复制缓冲区中指令（aof指令"),a("strong",[t._v("逐字符地")]),t._v("排布）以及更新后的offset（"),a("code",[t._v("+CONTINUE offset")]),t._v("）发送给slave")]),t._v(" "),a("p",[t._v("（若runid与offset核验不通过）重新开始全量复制")])]),t._v(" "),a("li",[a("p",[t._v("slave接收aof指令，保存新offset，并执行"),a("code",[t._v("bgrewriteaof")]),t._v("进行增量数据恢复")]),t._v(" "),a("p",[t._v("slave告知master增量数据的运行id与offset，若master核验通过，则本次增量同步完（"),a("strong",[t._v("增量复制")]),t._v("）")])])]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("通过"),a("code",[t._v("repl-backlog-size")]),t._v("指令合理控制复制缓冲区大小，避免全量复制时间过长时复制缓冲区溢出导致的数据丢失（此时再次执行全量复制，产生死循环）")]),t._v(" "),a("p",[t._v("最优复制缓冲区大小 = 2 * m-s平均重连时长 * m平均每秒写容量")])]),t._v(" "),a("li",[a("p",[t._v("通过"),a("code",[t._v("slave-serve-stale-data no")]),t._v("使slave端只提供有限的写数据功能（不对外提供数据服务）")])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("命令传播")])]),t._v(" "),a("ol",[a("li",[t._v("master定时向slave进行心跳检测")]),t._v(" "),a("li",[t._v("slave向master发送"),a("code",[t._v("REPLCONF ACK")]),t._v("响应")])]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("在"),a("code",[t._v("INFO REPLICATION")]),t._v("信息中的slave0等字段中维护距离上一个心跳包的时间间隔，正常值为1（或0）")])]),t._v(" "),a("li",[a("p",[t._v("命令传播阶段的配置项")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("min-slaves-to-write <num>")])]),t._v(" "),a("li",[a("code",[t._v("min-slaves-max-lag <time>")])])]),t._v(" "),a("p",[t._v("成功响应心跳的slave个数小于num，或所有slave的延迟都大于time时，强制关闭master的写功能，停止数据同步")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("repl-timeout")])])]),t._v(" "),a("p",[t._v("若slave在给定时间没有响应，则master将其释放")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("repl-ping-slave-period")])])]),t._v(" "),a("p",[t._v("心跳检测时间间隔（一般为上一项超时时间的1/10～1/5）")])])])])])]),t._v(" "),a("h3",{attrs:{id:"哨兵"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#哨兵"}},[t._v("#")]),t._v(" 哨兵")]),t._v(" "),a("ol",[a("li",[t._v("监控（同步信息）\n"),a("ol",[a("li",[t._v("连接master获取info")]),t._v(" "),a("li",[t._v("进行cmd连接以进行后续的命令交换")]),t._v(" "),a("li",[t._v("根据info信息连接关联的slave或sentinel")]),t._v(" "),a("li",[t._v("在同时存在的多个sentinel节点间组建发布订阅网络")])])]),t._v(" "),a("li",[t._v("通知")]),t._v(" "),a("li",[t._v("故障转移\n"),a("ol",[a("li",[t._v("发现问题")]),t._v(" "),a("li",[t._v("竞选负责人")]),t._v(" "),a("li",[t._v("负责人优选新master")]),t._v(" "),a("li",[t._v("切换各节点主从关系")])])])]),t._v(" "),a("h3",{attrs:{id:"集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群"}},[t._v("#")]),t._v(" 集群")]),t._v(" "),a("ul",[a("li",[t._v("Redis集群中设置"),a("strong",[t._v("16384")]),t._v("个哈希槽，集群中的每个节点负责一部分hash slots")]),t._v(" "),a("li",[t._v("存储key时，使用该key的CRC16值对16384取模以获取目标存储槽位")]),t._v(" "),a("li",[t._v("节点间槽位可互相转移（并行转移），使得集群拓展性高")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("集群主从模式")])]),t._v(" "),a("p",[t._v("Redis集群主从节点之间采用异步复制共享数据，因此不能保证强一致性，可能导致数据丢失")])]),t._v(" "),a("h2",{attrs:{id:"底层原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#底层原理"}},[t._v("#")]),t._v(" 底层原理")]),t._v(" "),a("h4",{attrs:{id:"线程模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#线程模型"}},[t._v("#")]),t._v(" 线程模型")]),t._v(" "),a("h6",{attrs:{id:"file-event-handler-单reactor单线程模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-event-handler-单reactor单线程模型"}},[t._v("#")]),t._v(" File Event Handler（单Reactor单线程模型）")]),t._v(" "),a("p",[t._v("单线程内存操作：IO多路复用程序（采用单线程、非阻塞地）同时监听多个Socket，将读入的Socket事件放入队列中，由dispatcher依次分配对应的handler")]),t._v(" "),a("ul",[a("li",[t._v("多个Socket")]),t._v(" "),a("li",[t._v("IO多路复用程序（事件分离器+IO处理器）")]),t._v(" "),a("li",[t._v("事件分派器")]),t._v(" "),a("li",[t._v("事件处理器\n"),a("ul",[a("li",[t._v("连接应答处理器")]),t._v(" "),a("li",[t._v("命令请求处理器")]),t._v(" "),a("li",[t._v("命令回复处理器")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);